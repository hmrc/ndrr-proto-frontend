@*
 * Copyright 2023 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.govukfrontend.views.html.components._
@import uk.gov.hmrc.ndrrprotofrontend.controllers._
@import uk.gov.hmrc.ndrrprotofrontend.models.Card

@(dashboardCard: Card)()

<div id="" class="card">

    <div class="card-body active min-height">
        @dashboardCard.titleKey.map { cardTitle =>
            <h@{cardTitle.headingLevel.getOrElse(2)} class="@toClasses("govuk-heading-s card-heading", cardTitle.classes)">
            @cardTitle.content.asHtml
            </h@{cardTitle.headingLevel.getOrElse(2)}>
        }

        @dashboardCard.captionKey.map { cardCaption =>
            <h@{cardCaption.headingLevel.getOrElse(2)} class="@toClasses("govuk-body", cardCaption.classes)">
            @cardCaption.content.asHtml
            </h@{cardCaption.headingLevel.getOrElse(2)}>
        }

        @dashboardCard.captionKey2.map { cardCaption =>
        <h@{cardCaption.headingLevel.getOrElse(2)} class="@toClasses("govuk-body", cardCaption.classes)">
        @cardCaption.content.asHtml
        </h@{cardCaption.headingLevel.getOrElse(2)}>
        }

        @dashboardCard.tag.map { tag =>
        <td class="govuk-table__cell">
            <strong class="govuk-tag govuk-tag--red">
                @tag.content.asHtml
            </strong>
        </td>
        }

    </div>

    <div class="card-action">
        @dashboardCard.links match {
            case None => {}
            case Some(cardAction) => {
                @if(cardAction.items.nonEmpty) {
                    @if(cardAction.items.length == 1) {
                        <div class="@toClasses("govuk-link", cardAction.classes)">
                        @actionLink(cardAction.items.head, Some(cardAction.items.head.content))
                        </div>
                    } else {
                        <ul class="govuk-list">
                            <a class="govuk-link">
                                @cardAction.items.map { item =>
                                <li>
                                    @actionLink(item, Some(item.content))
                                </li>
                                }
                            </a>
                        </ul>
                    }
                }
            }
        }
    </div>
</div>

        @actionLink(action: ActionItem, cardTitle: Option[Content]) = {
        <a class="@toClasses("govuk-link", action.classes)" href="@action.href"@toAttributes(action.attributes)>@action.content.asHtml@visuallyHiddenText(action, cardTitle)</a>}

        @visuallyHiddenText(action: ActionItem, cardTitle: Option[Content]) = {@if(action.visuallyHiddenText.exists(_.nonEmpty) || cardTitle.isDefined) {<span class="govuk-visually-hidden"> @{action.visuallyHiddenText.map(_.strip)}@if(cardTitle.isDefined){@cardTitle.map {content => (@content.asHtml)}}</span>}}

